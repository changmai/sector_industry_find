@echo off
chcp 65001 >nul
REM ================================================================================
REM   [시뮬레이션 12] 조건 H 파라미터 그리드 테스트 (Mode 3) - 2차 최적화
REM ================================================================================
REM
REM   1차 테스트 결과 (2024.12.13):
REM   --------------------------------------------------------------------------
REM   최적 조합: smart_money_turnover=3, support_margin=0.02, support_lower=0.97
REM   → 거래 2,242건, 승률 32.8%, 수익률 -0.27%
REM
REM   발견된 패턴:
REM   - smart_money_turnover: 낮을수록 좋음 (3% > 5% > 10%)
REM   - support_margin: 낮을수록 좋음 (0.02 > 0.03 > 0.05)
REM   - support_lower: 0.97~0.98이 최적
REM
REM   2차 테스트 목적:
REM   --------------------------------------------------------------------------
REM   최적 범위 주변에서 더 세밀한 탐색
REM
REM   테스트 파라미터 (세분화):
REM   --------------------------------------------------------------------------
REM   - smart_money_turnover: 1.5, 2.0, 2.5, 3.0, 4.0 (낮은 범위 집중)
REM   - support_margin: 0.01, 0.015, 0.02, 0.025, 0.03 (세분화)
REM   - support_lower: 0.96, 0.97, 0.98 (최적 범위)
REM
REM   총 조합: 5 x 5 x 3 = 75개
REM
REM   기간: 2024.05.29 ~ 2025.06.30 (약 13개월)
REM   TP/SL: 10% / -5%
REM
REM   성능 최적화:
REM   --------------------------------------------------------------------------
REM   - Numba JIT: 자동 활성화 (시뮬레이션 4x 속도 향상)
REM   - Multiprocessing: --workers 12 (CPU 온도 관리, 50% 코어 사용)
REM   - float32 최적화: 메모리 50% 절감
REM
REM   결과 해석:
REM   --------------------------------------------------------------------------
REM   - 거래수 > 0인 파라미터 조합 확인
REM   - 승률, 평균수익률 기준으로 최적 파라미터 선택
REM   - 선택한 파라미터를 default.json에 반영
REM ================================================================================

cd /d "%~dp0.."

python combination_tester.py ^
    --conditions H ^
    --param-grid "H.smart_money_turnover:1.5,2.0,2.5,3.0,4.0;H.support_margin:0.01,0.015,0.02,0.025,0.03;H.support_lower:0.96,0.97,0.98" ^
    --start-date 20240529 ^
    --end-date 20250630 ^
    --tp 10 ^
    --sl -5 ^
    --max-holding 14 ^
    --min-trades 1 ^
    --sort-by avg_return ^
    --top 50 ^
    --workers 12 ^
    --log

echo.
echo ================================================================================
echo   테스트 완료
echo ================================================================================
echo   결과에서 최적 파라미터 조합을 확인하세요.
echo   최적 파라미터를 default.json에 반영하세요.
echo ================================================================================

pause
