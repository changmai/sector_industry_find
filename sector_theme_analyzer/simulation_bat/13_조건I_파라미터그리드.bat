@echo off
chcp 65001 >nul
REM ================================================================================
REM   [시뮬레이션 13] 조건 I 파라미터 그리드 테스트 (Mode 3)
REM ================================================================================
REM
REM   문제점:
REM   --------------------------------------------------------------------------
REM   조건 I (급등주 조정)가 현재 파라미터로 거래수 0건 발생
REM   → 파라미터가 너무 엄격하여 신호가 발생하지 않음
REM
REM   목적:
REM   --------------------------------------------------------------------------
REM   파라미터 그리드 탐색으로 신호가 발생하는 범위를 찾기
REM
REM   테스트 파라미터:
REM   --------------------------------------------------------------------------
REM   - disparity_min: 1.05, 1.08, 1.10, 1.15 (20일선 대비 최소 이격도)
REM   - disparity_max: 1.15, 1.20, 1.25, 1.30 (20일선 대비 최대 이격도)
REM   - support_margin: 0.01, 0.02, 0.03 (5일선 대비 허용 마진)
REM
REM   총 조합: 4 x 4 x 3 = 48개
REM
REM   기간: 2024.05.29 ~ 2025.06.30 (약 13개월)
REM   TP/SL: 10% / -5%
REM
REM   성능 최적화:
REM   --------------------------------------------------------------------------
REM   - Numba JIT: 자동 활성화 (시뮬레이션 4x 속도 향상)
REM   - Multiprocessing: --workers 0 (전체 CPU 코어 자동 사용)
REM   - float32 최적화: 메모리 50% 절감
REM
REM   결과 해석:
REM   --------------------------------------------------------------------------
REM   - 거래수 > 0인 파라미터 조합 확인
REM   - 승률, 평균수익률 기준으로 최적 파라미터 선택
REM   - 선택한 파라미터를 default.json에 반영
REM
REM   다음 단계:
REM   --------------------------------------------------------------------------
REM   1. 이 테스트 결과에서 최적 파라미터 확인
REM   2. default.json 업데이트 (수동 또는 --update-defaults)
REM   3. 14_조건HI_자동최적화.bat 실행
REM ================================================================================

cd /d "%~dp0.."

python combination_tester.py ^
    --conditions I ^
    --param-grid "I.disparity_min:1.05,1.08,1.10,1.15;I.disparity_max:1.15,1.20,1.25,1.30;I.support_margin:0.01,0.02,0.03" ^
    --start-date 20240529 ^
    --end-date 20250630 ^
    --tp 10 ^
    --sl -5 ^
    --max-holding 14 ^
    --min-trades 1 ^
    --sort-by avg_return ^
    --top 50 ^
    --workers 0 ^
    --log

echo.
echo ================================================================================
echo   테스트 완료
echo ================================================================================
echo   결과에서 거래수 ^> 0인 파라미터 조합을 확인하세요.
echo   최적 파라미터를 default.json에 반영 후 14번 BAT을 실행하세요.
echo ================================================================================

pause
